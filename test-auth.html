<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MessMate Authentication Test</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      max-width: 600px; 
      margin: 50px auto; 
      padding: 20px; 
    }
    .test-section { 
      border: 1px solid #ccc; 
      padding: 20px; 
      margin: 20px 0; 
      border-radius: 8px; 
    }
    .status { 
      padding: 10px; 
      margin: 10px 0; 
      border-radius: 4px; 
    }
    .success { 
      background-color: #d4edda; 
      color: #155724; 
      border: 1px solid #c3e6cb; 
    }
    .error { 
      background-color: #f8d7da; 
      color: #721c24; 
      border: 1px solid #f5c6cb; 
    }
    .info { 
      background-color: #d1ecf1; 
      color: #0c5460; 
      border: 1px solid #bee5eb; 
    }
    button { 
      padding: 10px 20px; 
      margin: 5px; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
    }
    .primary { 
      background-color: #007bff; 
      color: white; 
    }
    .secondary { 
      background-color: #6c757d; 
      color: white; 
    }
    input { 
      padding: 8px; 
      margin: 5px 0; 
      width: 200px; 
      border: 1px solid #ccc; 
      border-radius: 4px; 
    }
  </style>
</head>
<body>
  <h1>MessMate Authentication Test</h1>
  
  <div class="test-section">
    <h2>1. Environment Check</h2>
    <div id="env-status"></div>
    <button onclick="checkEnvironment()" class="primary">Check Environment</button>
  </div>

  <div class="test-section">
    <h2>2. Supabase Initialization</h2>
    <div id="supabase-status"></div>
    <button onclick="testSupabase()" class="primary">Test Supabase</button>
  </div>

  <div class="test-section">
    <h2>3. Authentication Test</h2>
    <div>
      <input type="email" id="test-email" placeholder="Email" value="demo@messmate.com">
      <input type="password" id="test-password" placeholder="Password" value="demo123">
    </div>
    <button onclick="testAuthentication()" class="primary">Test Sign In</button>
    <div id="auth-status"></div>
  </div>

  <div class="test-section">
    <h2>4. Console Logs</h2>
    <p class="info">Open browser console (F12) to see detailed logs</p>
    <div id="log-output"></div>
  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // Configuration (same as in authentication.js)
    const SUPABASE_URL = 'https://faetszbcjwfosgexemhz.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZhZXRzemJjandmb3NnZXhlbWh6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1ODA5NjMsImV4cCI6MjA3NTE1Njk2M30.XPdnaw65T_ZclF9otchyRL-s6jRL_P4oy9wJUsloh6I';

    let supabase;
    
    function updateStatus(elementId, message, type = 'info') {
      const element = document.getElementById(elementId);
      element.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    function checkEnvironment() {
      console.log('üîç Checking environment...');
      
      const checks = [
        { name: 'Supabase URL', value: SUPABASE_URL, valid: !!SUPABASE_URL },
        { name: 'Supabase Key', value: SUPABASE_ANON_KEY ? SUPABASE_ANON_KEY.substring(0, 20) + '...' : 'Not set', valid: !!SUPABASE_ANON_KEY },
        { name: 'Supabase Library', value: window.supabase ? 'Loaded' : 'Not loaded', valid: !!window.supabase }
      ];
      
      let html = '<h3>Environment Variables:</h3>';
      checks.forEach(check => {
        const status = check.valid ? 'success' : 'error';
        const icon = check.valid ? '‚úÖ' : '‚ùå';
        html += `<div class="status ${status}">${icon} ${check.name}: ${check.value}</div>`;
      });
      
      document.getElementById('env-status').innerHTML = html;
    }

    function testSupabase() {
      console.log('üß™ Testing Supabase initialization...');
      
      try {
        if (!window.supabase) {
          updateStatus('supabase-status', '‚ùå Supabase library not loaded', 'error');
          return;
        }

        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        if (supabase) {
          updateStatus('supabase-status', '‚úÖ Supabase client created successfully!', 'success');
          console.log('‚úÖ Supabase client:', supabase);
        } else {
          updateStatus('supabase-status', '‚ùå Failed to create Supabase client', 'error');
        }
      } catch (error) {
        console.error('‚ùå Supabase initialization error:', error);
        updateStatus('supabase-status', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    async function testAuthentication() {
      const email = document.getElementById('test-email').value;
      const password = document.getElementById('test-password').value;
      
      console.log('üîê Testing authentication with:', email);
      
      if (!supabase) {
        updateStatus('auth-status', '‚ùå Supabase not initialized. Click "Test Supabase" first.', 'error');
        return;
      }

      try {
        updateStatus('auth-status', '‚è≥ Signing in...', 'info');
        
        const { data, error } = await supabase.auth.signInWithPassword({
          email: email.trim(),
          password: password
        });

        console.log('üîç Supabase response:', { data, error });

        if (error) {
          console.error('‚ùå Authentication error:', error);
          updateStatus('auth-status', `‚ùå Authentication failed: ${error.message}`, 'error');
        } else if (data.user) {
          console.log('‚úÖ Authentication successful!', data.user);
          updateStatus('auth-status', `‚úÖ Welcome ${data.user.email}! Authentication successful.`, 'success');
        } else {
          console.warn('‚ö†Ô∏è No user data returned');
          updateStatus('auth-status', '‚ö†Ô∏è No user data returned from Supabase', 'error');
        }
      } catch (error) {
        console.error('‚ùå Unexpected error:', error);
        updateStatus('auth-status', `‚ùå Unexpected error: ${error.message}`, 'error');
      }
    }

    // Auto-run environment check on load
    window.onload = function() {
      checkEnvironment();
    };
  </script>
</body>
</html>