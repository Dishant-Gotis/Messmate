<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MessMate - Discover Local Mess Services</title>
  <meta name="description" content="Discover local mess (communal dining) services. Professional mess management platform with modern design.">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%232563EB'/%3E%3Ctext x='50' y='60' text-anchor='middle' font-size='44' fill='white'%3EM%3C/text%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="brand">
      <div class="brand-logo">M</div>
      <div>
        <div style="font-size:18px; font-weight:700;">MessMate</div>
        <div class="muted" style="margin-top:-4px;">Discover local mess services</div>
      </div>
    </div>
    <div class="nav-actions">
      <a href="login.html" class="btn ghost">Login</a>
      <a href="signup.html" class="btn">Sign Up</a>
      <a href="admin.html" class="btn ghost">Admin Panel</a>
    </div>
  </header>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Modal Overlay -->
  <div id="modal-overlay" class="overlay" aria-hidden="true"></div>

  <!-- Main Content -->
  <main class="container">
    <div class="row mb-16">
      <h1 class="section-title" style="margin:0">Find a great mess near you</h1>
    </div>

    <!-- Filters -->
    <div class="filters card">
      <div class="row">
        <div class="row" role="group" aria-label="Filter mess type">
          <button class="btn ghost small active" data-filter="all">All</button>
          <button class="btn ghost small" data-filter="veg">Veg</button>
          <button class="btn ghost small" data-filter="non-veg">Non-Veg</button>
          <button class="btn ghost small" data-filter="both">Both</button>
        </div>
        <div class="spacer"></div>
        <input id="search-input" class="input search" placeholder="Search mess name or menu...">
        <select id="sort-select" class="select">
          <option value="distance">Sort: Nearest</option>
          <option value="rating">Sort: Rating</option>
          <option value="price-asc">Sort: Price (Low to High)</option>
          <option value="price-desc">Sort: Price (High to Low)</option>
        </select>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loading-grid" class="grid mess">
      <div class="card skeleton-card skeleton"></div>
      <div class="card skeleton-card skeleton"></div>
      <div class="card skeleton-card skeleton"></div>
    </div>

    <!-- Mess Grid -->
    <div id="mess-grid" class="grid mess hidden"></div>

    <!-- Empty State -->
    <div id="empty-state" class="card hidden" style="padding:40px; text-align:center;">
      <div style="font-size:60px; margin-bottom:16px;">üçΩÔ∏è</div>
      <h3 style="margin:0 0 8px 0; color:var(--text-primary);">No messes found</h3>
      <p class="muted">Try changing your filters or search terms.</p>
    </div>
  </main>

  <!-- Supabase Auth Script -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="authentication.js"></script>
  
  <!-- Authentication Guard -->
  <script>
    // Protected page - redirect to login if not authenticated
    async function initializeProtectedPage() {
      console.log('üîç Initializing protected page...');
      
      // Wait for authentication to initialize
      await new Promise(resolve => {
        if (window.checkAuthStatus) {
          resolve();
        } else {
          const checkInterval = setInterval(() => {
            if (window.checkAuthStatus) {
              clearInterval(checkInterval);
              resolve();
            }
          }, 100);
        }
      });
      
      // Check authentication status
      const isAuthenticated = await window.checkAuthStatus();
      
      if (!isAuthenticated) {
        console.log('üîí User not authenticated, redirecting to login...');
        window.location.replace('login.html');
        return;
      }
      
      console.log('‚úÖ User authenticated, showing page content');
      // Show page content
      document.body.style.visibility = 'visible';
    }
    
    // Hide page content initially
    document.body.style.visibility = 'hidden';
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeProtectedPage);
    } else {
      initializeProtectedPage();
    }
  </script>
  
  <script src="main.js"></script>
</body>
</html>